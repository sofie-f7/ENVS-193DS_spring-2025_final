---
title: "ENVS 193DS Final"
author: "Sofie Flom"
date: "8 June 2025"
format:
  html:
    toc: true # use this to display a table of contents
execute:
  message: false # use this to make sure messages don't show up
  warning: false # use this to make sure warnings don't show up
---
[Repo link](https://github.com/sofie-f7/ENVS-193DS_spring-2025_final)

```{r packages-and-data, message=FALSE}
library(tidyverse) # general use
library(here) # file organization
library(janitor) # cleaning data frames
library(MuMIn) # model selection
library(ggeffects) # getting model predictions

sst <- read_csv(here("data", "SST_update2023.csv")) #read in Santa Barbara SST data in data folder

bird_data <- read_csv(here("data", "occdist.csv")) #read in data for Problem 3 from data folder

```

# Problem 1. 

## a. 

In part 1, they used a Pearson's r test. In part 2, they used an analysis of variance (one-way ANOVA) test. 

## b. 

One additional piece of information that should be included is the significance level that was used to compare the p-value. This would add useful additional context because it provides more transparency to the test that was done and tells how strict the test was.
Another test that should be included is Tukey's HSD. This would be useful because it would explain which sources are actually statistically different in mean nitrogen load from each other when you compare them. The ANOVA test result says that at least one group is significantly different, but not which one(s). 

## c. 

We rejected the null hypothesis that there is no correlation between distance from headwater (km) and annual total nitrogen load (kg year-1) (Pearson's r = **correlation coefficient**, p = 0.03, $\alpha$ = **significance level**).

We rejected the null hypothesis that there is no difference in average nitrogen load (kg year-1) between sources (n = sample sizes) (urban land, atmospheric deposition, fertilizer, wastewater treatment, and grasslands) (one-way ANOVA, F(**among groups df, within groups df**) = **F-statistic**, p = 0.02, $\alpha$ = **significance level**). We found a ___ effect ($\eta^2$ = **effect size**) of nitrogen source on nitrogen load. On average, **source type** tended to have smaller/larger nitrogen loads than **source type** (**Tukey's HSD**).

# Problem 2.

## a. 

```{r cleaning-and-summarizing}
sst_clean <- sst |> #create new sst_clean dataframe from sst dataframe
  select(-site, -latitude, -longitude) |> #remove site, latitude, and longitude columns
  filter(date > as_date("2017-12-31")) |> #only include dates after 2017
  mutate(month = factor(month(date, label = TRUE, abbr = TRUE), #extract month from the date column and set as factor
                      levels = c("Jan", "Feb", "Mar", "Apr", "May", "Jun", 
                                 "Jul", "Aug", "Sep", "Oct", "Nov", "Dec")), #set month as ordered factor with these levels
         year = factor(as.character(year(date)), #set year as factor and extract year from the date column
                       levels = c("2018", "2019", "2020", "2021", "2022", "2023"))) |> 
  group_by(year, month) |> #group by months and year
  summarize(mean_monthly_sst = mean(temp)) |> #calculate the monthly mean sst 
  ungroup() #ungroup 

```

```{r}
slice_sample(sst_clean, n = 5) #display 5 rows from sst_clean
```

```{r}
str(sst_clean) #display structure of sst_clean
```

## b. 

```{r visualize-data}
ggplot(data = sst_clean, #use the sst_clean dataframe
       aes(x = month, #make the x-axis the month
           y = mean_monthly_sst), #make the y-axis the mean monthly sst
           color = year) + #color by the year
  geom_point(aes(color = year)) + #add points and color by year
  geom_line(aes(group = year, color = year)) + #add a line for each year and color by year
  labs(x = "Month", #rename the x-axis
       y = "Mean monthly sea surface temperature (°C)", #rename the y-axis
       color = "Year") + #name the legend
  theme(panel.background = element_blank(), #make the panel background blank
        legend.position = c(0.05, 0.95), #position the legend inside the plot
        panel.grid = element_blank(), #remove the gridlines
        legend.justification = c("left", "top"), #align the legend to top left
        panel.border = element_rect(color = "black", fill = NA, linewidth = 0.5)
) + #add a panel border
  scale_color_manual(values = c("2018" = "#deebf7", #change color of 2018 line
                                "2019" = "#c6dbef", #change color of 2019 line
                                "2020" = "#9ecae1", #change color of 2020 line
                                "2021" = "#6baed6", #change color of 2021 line
                                "2022" = "#3182bd", #change color of 2022 line
                                "2023" = "#08519c")) #change color of 2023 line

```

# Problem 3. 

## a. 

In this data set, 0s mean there is no nest occupancy and 1s mean there is nest occupancy. The 1s and 0s are a measure of if the nest is occupied by a bird or not.

## b. 

Swift Parrots are very selective about where they nest, whereas Tree Martins and Common Starlings are much less selective. 

## c. 

2016 and 2019 are the two years that the authors refer to as "seasons." In 2016, they deployed nest boxes at a Swift Parrot breeding site where a mast tree flowering event triggered nesting, and they did the same in 2019 when same mast tree flowering event occurred. The 2016 season is referred to as "newly deployed" and the 2019 season is referred to as "established."

## d. 

| Model number | Season | Distance to forest edge | Model description          |  
|:------------:|:------:|:-----------------------:|:--------------------------:|  
| 0            |        |                         | no predictors (null model) |
| 1            |   X    |        X                | all predictors (full model)| 
| 2            |   X    |                         | season                     |   
| 3            |        |        X                | distance to forest edge    |    

## e. 

```{r}
bird_data_clean <- bird_data |> #create new bird_data_clean dataframe using bird_data dataframe
  clean_names() #clean the column names

# model 0: null model
model0 <- lm( #create model object using linear model function
  e ~ 1, # formula for null model
  data = bird_data_clean # using bird_data_clean data frame
)

# model 1: all predictors
model1 <- lm( #create model object using linear model function
  e ~ season + edge_distance, #e is response and season + edge distance are predictors
  data = bird_data_clean # using bird_data_clean data frame
)

# model 2: season
model2 <- lm( #create model object using linear model function
  e ~ season, #e is response and season is predictor
  data = bird_data_clean # using bird_data_clean data frame
)

# model 3: edge distance
model3 <- lm( #create model object using linear model function
  e ~ edge_distance, #e is response and edge distance is predictor
  data = bird_data_clean # using bird_data_clean data frame
)
```

## f. 

```{r model-diagnostics}
par(mfrow = c(2,2))
plot(model1)
plot(model2)
plot(model3)
```

## g. 

```{r model-selection}
AICc( #using Akaike’s Information Criterion (AIC) function
  model0, #check model 0
  model1, #check model 1
  model2, #check model 2
  model3) |> #check model 3
   arrange(AICc) #arranging output in descending order of AIC
```
```{r model-summary}
summary(model1)
```

The best model that predicts box occupancy as determined by Akaike’s Information Criterion (AIC) includes season and edge distance (F(2, 224) = 12.17, p < 0.001, $\alpha$ = 0.05).

## h. 

```{r}
model1_predictions <- ggpredict(
  model1,
  terms = c("season", "edge_distance") #predictors
) |> 
  rename(season = x,
         edge_distance = group)

#| fig-width: 12
#| fig-height: 4

# base layer: ggplot
ggplot(data = bird_data_clean, # using the bird_data_clean object
       aes(x = water_treatment,
           y = e,
           color = water_treatment)) +
  # first layer: jitter showing individual observations
  geom_jitter(width = 0.1,
              height = 0,
              shape = 21,
              alpha = 0.6) +
  # second layer: point range showing model predictions
  # note that this is appropriate because there are only categorical predictors
  # in the final model
  geom_pointrange(data = model4_predictions,
                  aes(y = predicted,
                      ymin = conf.low,
                      ymax = conf.high)) +
  # manually setting colors
  scale_color_manual(values = c("Well watered" = ww_col,
                                "Drought stressed" = ds_col)) +
  # wrapping x-axis labels
  scale_x_discrete(labels = label_wrap(10)) +
  # creating different panels for each species
  facet_wrap(~species_name, nrow = 1) +
  # labelling x- and y-axis
  labs(x = "Water treatment",
       y = "Total mass (g)") +
  # taking out the legend
  theme(legend.position = "none")
```

## i. 


# Problem 4. 

## a. 

- How are the visualizations different from each other in the way you have represented your data?

The visualizations are very different from each other in the way that I have represented my data. My visualizations from homework 2 were a box and jitter plot and a line graph, while my visualization from homework 3 was an artistic visualization, with the data represented by drawings of brain waves and colors. The visualizations in homework 2 displayed the data in a very scientific way without evoking much emotion, while the visualization in homework 3 shows the data in a creative and unique way. Also, in homework 2, I used sleep quality and if I went on my phone before bed as predictors of hours slept, while in homework 3 I used class day as a predictor of hours slept.

- What similarities do you see between all your visualizations?

Between all of my visualizations, the number of hours slept is the response variable, meaning that all of my visualizations are visualizing how various predictors predict hours slept. They each communicate patterns in my sleep behavior. Both the box-and-jitter plot and the affective visualization use color to communicate differences in the categorical variables of class day and phone usage. These two visualizations also are similar in their use of a categorical predictor variable. The box-and-jitter plot and the line graph are similar in their formal portrayal of the data.

- What patterns (e.g. differences in means/counts/proportions/medians, trends through time, relationships between variables) do you see in each visualization? Are these different between visualizations? If so, why? If not, why not?



- What kinds of feedback did you get during week 9 in workshop or from the instructors? How did you implement or try those suggestions? If you tried and kept those suggestions, explain how and why; if not, explain why not.

